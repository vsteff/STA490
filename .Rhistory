getwd()
load("glu_v01.RData")
CV <- function(mean, sd) (sd/mean)*100
glu$cv <- glu$high.var <- rep(NA, nrow(glu))
npatients <- length(unique(glu$PID))  # 41428
for (i in 1:npatients) {  # i: patient
pat.glu <- glu[which(as.numeric(glu$PID) == i), "Glu"]
pat.inp <- glu[which(as.numeric(glu$PID) == i), "Inpatient"]
glu[which(as.numeric(glu$PID) == i), "cv"] <- ifelse(pat.inp == TRUE, CV(mean(pat.glu), sd(pat.glu)), NA)
}
glu$high.var <- ifelse(glu$cv > 15, 1, 0)
glu[1:100, c("PID", "Time", "Inpatient", "cv", "high.var")]
summary(glu$high.var)
table(glu$high.var)
glu$high.var2 <- ifelse(glu$cv > 20, 1, 0)
table(glu$high.var)
table(glu$high.var2)
which(as.numeric(glu$PID) == 1:50)
glu[which(as.numeric(glu$PID) <= 50), c("PID", "Time", "Inpatient", "cv", "high.var")]
glu[which(as.numeric(glu$PID) <= 100), c("PID", "Time", "Inpatient", "cv", "high.var")]
glu[which(as.numeric(glu$PID) <= 200), c("PID", "Time", "Inpatient", "cv", "high.var")]
i <- 196
pat.glu <- glu[which(as.numeric(glu$PID) == i), "Glu"]
pat.glu
table(glu$high.var)
table(glu$high.var2)
save(glu, file = "glu_v02.RData")
getwd()
load("ward.assign.RData")
for (i in 1:length(glu$Ward)) {
for (j in 1:length(wardsclean$Ward)) {
if (glu[i, "Ward"] == wardsclean$Ward[j]) {
glu$wardclean[i] <- wardsclean$name[j]
}
}
}
str(glu$wardclean)
summary(glu$wardclean)
i <- 1
j <- 1
(glu[i, "Ward"] == wardsclean$Ward[j])
glu[i, "Ward"]
wardsclean$Ward[j]
glu$wardclean[i]
wardsclean$name[j]
glu$wardclean[i] <- wardsclean$name[j]
glu$wardclean[i]
ONKP
wardsclean$name[j]
a <- wardsclean$name[j]
a
a <- as.character(wardsclean$name)
a
wardsclean$name <- as.character(wardsclean$name)
head(glu)
a <- system.time()
a <- Sys.time()
b <- Sys.time()
a <- Sys.time()
for (i in 1:10) {  # length(glu$Ward)
for (j in 1:length(wardsclean$Ward)) {
if (glu[i, "Ward"] == wardsclean$Ward[j]) {
glu$wardclean[i] <- wardsclean$name[j]
}
}
}
b <- Sys.time()
b-a
head(glu)
a <- Sys.time()
for (i in 1:length(glu$Ward)) {
for (j in 1:length(wardsclean$Ward)) {
if (glu[i, "Ward"] == wardsclean$Ward[j]) {
glu$wardclean[i] <- wardsclean$name[j]
}
}
}
b <- Sys.time()
b-a
head(glu)
summary(glu$wardclean)
c <- as.factor(glu$wardclean)
str(c)
c <- factor(glu$wardclean)
str(c)
c
glu$Ward.ano <- factor(glu$Ward)
levels(glu$Ward.number) <- 1:length(levels(glu$Ward))
glu$Ward.number <- factor(glu$Ward)
levels(glu$Ward.number) <- 1:length(levels(glu$Ward))
glu$Ward <- factor(glu$wardclean)
b-a
library("lubridate")
glu$Time.trunc <- floor_date(glu$Time, unit = "day")
# Order data after PID and Time
glu$Time.trunc <- as.chron(glu$Time.trunc)
glu <- glu[order(glu$PID, glu$Time), ]
# Define inpatient factor
# Inpatient = at least two successive Glu values on different days
glu$Inpatient <- rep(NA, nrow(glu))
# loop
npatients <- length(unique(glu$PID))  # 41428
nrow(glu)/npatients  # mean observations per patient
head(glu)
glu2 <- glu
save(glu2, file = "wardcols.RData")
b-a
